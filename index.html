<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>POI Finder VN ‚Äì 5 ƒë·ªãa ƒëi·ªÉm g·∫ßn nh·∫•t</title>
  <!-- Tailwind (CDN) for quick styling) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CSS/JS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <style>
    #map { height: 70vh; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="max-w-5xl mx-auto p-4">
    <h1 class="text-2xl md:text-3xl font-bold">POI Finder VN</h1>
    <p class="text-sm text-slate-600">Nh·∫≠p t√™n m·ªôt ƒë·ªãa ƒëi·ªÉm ·ªü Vi·ªát Nam ‚Üí B·∫£n ƒë·ªì s·∫Ω hi·ªÉn th·ªã <strong>5 ƒëi·ªÉm quan t√¢m (POI)</strong> g·∫ßn nh·∫•t.</p>
  </header>

  <main class="max-w-5xl mx-auto p-4 space-y-4">
    <!-- Search Form -->
    <div class="bg-white rounded-2xl shadow p-4 md:p-6 flex flex-col gap-3">
      <div class="grid grid-cols-1 md:grid-cols-6 gap-3 items-end">
        <div class="md:col-span-4">
          <label for="place" class="text-sm font-medium">ƒê·ªãa ƒëi·ªÉm (v√≠ d·ª•: "H·ªì G∆∞∆°m, H√† N·ªôi" / "Qu·∫≠n 1, TP.HCM")</label>
          <input id="place" type="text" class="mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm..." />
        </div>
        <div class="md:col-span-1">
          <label for="radius" class="text-sm font-medium">B√°n k√≠nh (m)</label>
          <select id="radius" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="800">800</option>
            <option value="1200" selected>1200</option>
            <option value="1600">1600</option>
            <option value="2000">2000</option>
          </select>
        </div>
        <div class="md:col-span-1 flex gap-2">
          <button id="searchBtn" class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 font-semibold">T√¨m</button>
        </div>
      </div>
      <p id="status" class="text-sm text-slate-500"></p>
    </div>

    <!-- Map -->
    <div id="map" class="rounded-2xl shadow"></div>

    <!-- Results -->
    <div class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-bold mb-2">5 POI g·∫ßn nh·∫•t</h2>
      <ol id="poiList" class="list-decimal pl-6 space-y-1 text-sm"></ol>
    </div>

    <p class="text-xs text-slate-400">D·ªØ li·ªáu: ¬© OpenStreetMap contributors (Nominatim, Overpass). ·ª®ng d·ª•ng d√πng cho m·ª•c ƒë√≠ch demo/gi√°o d·ª•c.</p>
  </main>

  <script>
    // --- Utility: Haversine distance (m) ---
    function haversine(lat1, lon1, lat2, lon2) { /* ... gi·ªØ nguy√™n ... */ }

    // --- Leaflet map init ---
    const map = L.map('map').setView([16.047, 108.206], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    let originMarker;
    let poiLayer = L.layerGroup().addTo(map);

    const statusEl = document.getElementById('status');
    const listEl = document.getElementById('poiList');
    const searchBtn = document.getElementById('searchBtn');

    // --- WEATHER FUNCTIONS ---
    async function fetchWeather(lat, lon) {
      const apiKey = "43b9608ffa211408507384378f0f374d"; // üîë thay b·∫±ng key th·∫≠t
      const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(
  `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=vi`
)}`;
git add index.html
git commit -m "Fix CORS for OpenWeather"
git push

      const res = await fetch(url);
      if (!res.ok) throw new Error('L·ªói khi l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt');
      return res.json();
    }

    async function showWeather(lat, lon, placeName) {
      try {
        const w = await fetchWeather(lat, lon);
        const desc = w.weather?.[0]?.description ?? "Kh√¥ng r√µ";
        const temp = w.main?.temp?.toFixed(1) ?? "?";
        const feels = w.main?.feels_like?.toFixed(1) ?? "?";
        const humid = w.main?.humidity ?? "?";
        const icon = w.weather?.[0]?.icon;
        const iconUrl = icon ? `https://openweathermap.org/img/wn/${icon}@2x.png` : "";

        const container = document.querySelector(".bg-white.rounded-2xl.shadow.p-4:last-of-type");
        let weatherBox = document.getElementById("weatherBox");
        if (!weatherBox) {
          weatherBox = document.createElement("div");
          weatherBox.id = "weatherBox";
          weatherBox.className = "mt-4 bg-blue-50 border border-blue-200 rounded-xl p-3 flex items-center gap-3";
          container.parentNode.insertBefore(weatherBox, container.nextSibling);
        }

        weatherBox.innerHTML = `
          <img src="${iconUrl}" alt="icon" class="w-12 h-12">
          <div>
            <div class="font-medium text-blue-700">Th·ªùi ti·∫øt t·∫°i ${placeName}</div>
            <div>Nhi·ªát ƒë·ªô: ${temp}¬∞C (c·∫£m gi√°c: ${feels}¬∞C)</div>
            <div>M√¥ t·∫£: ${desc}, ƒê·ªô ·∫©m: ${humid}%</div>
          </div>
        `;
      } catch (err) {
        console.error(err);
      }
    }

    // --- C√°c h√†m geocode(), fetchPOIs(), renderPOIs() gi·ªØ nguy√™n ---

    async function handleSearch() {
      const place = document.getElementById('place').value.trim();
      const radius = parseInt(document.getElementById('radius').value, 10) || 1200;
      if (!place) {
        alert('Vui l√≤ng nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm ·ªü Vi·ªát Nam.');
        return;
      }
      statusEl.textContent = 'ƒêang t√¨m t·ªça ƒë·ªô...';
      try {
        const geo = await geocode(place);
        if (!geo) {
          statusEl.textContent = 'Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm.';
          return;
        }
        const lat = parseFloat(geo.lat), lon = parseFloat(geo.lon);
        statusEl.textContent = `ƒê√£ ƒë·ªãnh v·ªã: ${geo.display_name}. ƒêang t√¨m POI...`;

        map.setView([lat, lon], 15);
        const pois = await fetchPOIs(lat, lon, radius);
        renderPOIs({ lat, lon, display_name: geo.display_name }, pois);
        await showWeather(lat, lon, geo.display_name);
        statusEl.textContent = `Ho√†n t·∫•t. Hi·ªÉn th·ªã 5 POI g·∫ßn nh·∫•t.`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau.';
      }
    }

    searchBtn.addEventListener('click', handleSearch);
    document.getElementById('place').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleSearch();
    });
  </script>

</body>
</html>
